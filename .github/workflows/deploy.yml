- name: Setup Python
  uses: actions/setup-python@v4
  with:
    python-version: '3.10'

- name: Install dependencies
  run: |
    python -m venv .venv
    source .venv/bin/activate
    pip install ansible boto3 botocore

- name: Install Ansible Collections
  run: |
    source .venv/bin/activate
    ansible-galaxy collection install amazon.aws --collections-path ansible/collections

- name: Run Deployment
  run: |
    source .venv/bin/activate
    export ANSIBLE_COLLECTIONS_PATH=$PWD/ansible/collections
    ansible-playbook ansible/deploy.yml -i ansible/inventory.ini \
      --extra-vars "aws_key_name=ansible-key aws_region=us-east-1" -vvv
